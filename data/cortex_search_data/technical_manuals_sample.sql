-- =============================================================================
-- Technical Manuals PDF Chunks - Sample Data
-- =============================================================================
-- This file contains sample technical documentation chunks for the 
-- Grid Intelligence Agent's document search feature.
--
-- Usage:
--   snow sql -f data/cortex_search_data/technical_manuals_sample.sql \
--       -D "database=FLUX_DB" -c your_connection_name
-- =============================================================================

USE DATABASE IDENTIFIER('<% database %>');
USE SCHEMA PRODUCTION;

-- Create the technical manuals table if it doesn't exist
CREATE TABLE IF NOT EXISTS TECHNICAL_MANUALS_PDF_CHUNKS (
    CHUNK_ID NUMBER PRIMARY KEY,
    DOCUMENT_ID VARCHAR(100),
    CHUNK_TEXT VARCHAR(16777216),
    DOCUMENT_TYPE VARCHAR(200),
    SOURCE_SYSTEM VARCHAR(100) DEFAULT 'TECHNICAL_MANUALS_PDF',
    LANGUAGE VARCHAR(10) DEFAULT 'en',
    LANGUAGE_NAME VARCHAR(50) DEFAULT 'English',
    LANGUAGE_NATIVE VARCHAR(50) DEFAULT 'English'
);

-- Insert sample technical documentation chunks
INSERT INTO TECHNICAL_MANUALS_PDF_CHUNKS (CHUNK_ID, DOCUMENT_ID, CHUNK_TEXT, DOCUMENT_TYPE)
VALUES
(1, 'DOC_1', 'Transformer Oil Sampling and Analysis Procedure - Model 345kV Substation Units. To perform quarterly oil sampling on high-voltage transformers, follow these critical steps: 1) De-energize the transformer and allow minimum 4-hour cooling period. 2) Connect grounding cable to transformer tank using approved clamp assembly (Part #TG-4401). 3) Remove sampling valve cap located on lower tank section, typically 18 inches from ground level. 4) Purge initial 500ml of oil to clear contaminants from valve assembly. 5) Collect 1-liter sample in pre-cleaned glass container (Specification: ASTM D923 compliant). Sample must be analyzed within 72 hours for dissolved gas analysis (DGA) including hydrogen, methane, ethylene, and acetylene concentrations. Critical thresholds: Hydrogen >150ppm indicates potential arcing, Acetylene >35ppm suggests severe overheating. Document ambient temperature, transformer load percentage, and last maintenance date on Chain of Custody form COC-2024-TR.', 'Maintenance Procedure'),

(2, 'DOC_1', 'Bushing Insulation Resistance Testing Protocol for 138kV and 345kV Equipment. Configure Megger MIT1025 insulation tester to 10kV test voltage for porcelain bushings rated above 69kV. Ensure ambient temperature is between 10C and 40C for accurate readings - temperature coefficient affects results by approximately 2% per degree Celsius. Connect test leads: positive to bushing conductor, negative to grounding flange. Apply test voltage for exactly 60 seconds, record resistance values at 15-second intervals. Acceptable readings: >5000 MOhm for new bushings, >1000 MOhm for in-service units over 10 years. Values below 500 MOhm require immediate investigation and potential replacement. Common failure indicators include moisture ingress (gradual resistance decline over multiple tests), cracked porcelain (sudden resistance drop), or contaminated oil (erratic readings). Document results in Maintenance Management System using Work Order template WO-BUSH-TEST, including serial numbers, test conditions, and photographic evidence of any visible defects.', 'Testing Procedure'),

(3, 'DOC_1', 'Protective Relay Configuration - SEL-387E Differential Protection System. API Endpoint: POST /api/v1/relay/settings/differential. Required parameters: CT_ratio_primary (integer), CT_ratio_secondary (integer), pickup_current (float, 0.25-2.0 per unit), slope1_percentage (integer, 15-50%), slope2_percentage (integer, 50-100%). Optional parameters: harmonic_blocking (boolean, default: true), unrestrained_trip (float, 8.0-20.0 per unit). Example configuration for 50MVA transformer: CT_ratio_primary: 1200, CT_ratio_secondary: 5, pickup_current: 0.30, slope1_percentage: 25, slope2_percentage: 60. Best Practice: Always perform CT polarity verification before commissioning differential protection. Incorrect polarity causes false trips during normal load conditions. Use relay test set (Omicron CMC356 or equivalent) to inject balanced three-phase currents at 1.1x pickup setting - relay should NOT operate. Then inject unbalanced current simulating internal fault at 2.0x pickup - relay MUST operate within 2 cycles (33ms at 60Hz). Document all test results in relay commissioning report template REL-COMM-2024.', 'Configuration Guide'),

(4, 'DOC_2', 'Smart Meter Installation Procedure - Landis+Gyr Focus AX Series. Safety Requirements: De-energize meter socket before installation. Verify absence of voltage using approved non-contact voltage tester (minimum CAT III rating). Install meter base weatherhead seal to prevent moisture ingress. Torque blade terminals to 35 in-lbs using calibrated torque screwdriver. Communication Setup: The Focus AX supports multiple communication protocols - RF mesh (900 MHz), cellular (LTE Cat-M1), and Wi-Fi (802.11n). For RF mesh deployment, ensure minimum -85 dBm signal strength at meter location. Program meter using Landis+Gyr Command Center software via optical port (ANSI Type 2). Configure TOU schedules per rate class: Residential (Rate R) uses 2-period schedule, Commercial (Rate C) uses 3-period with demand ratchet. Set voltage monitoring thresholds: Under-voltage alert at 114V (95% nominal), Over-voltage alert at 126V (105% nominal). Enable power quality event logging with 1-second resolution for voltage sag/swell analysis.', 'Installation Guide'),

(5, 'DOC_2', 'AMI Network Troubleshooting Guide - RF Mesh Communication Issues. Symptom: Meter showing offline status >24 hours. Diagnostic Steps: 1) Check meter display for communication status indicators - solid LED indicates registered, flashing indicates searching for network. 2) Using Landis+Gyr Field Tool, query meter diagnostics: READ_COMM_STATS command returns packet success rate, RSSI values, and neighbor table. 3) Acceptable RSSI: -70 dBm or stronger. Marginal: -70 to -85 dBm (may require repeater). Unacceptable: Below -85 dBm (relocate meter or add network infrastructure). 4) Check neighbor count - healthy meters should have 3+ neighbors. Single neighbor indicates network edge condition. 5) For meters with no neighbors, perform site survey using spectrum analyzer to identify RF interference sources. Common interferers: LED lighting (especially commercial), HVAC motor drives, amateur radio operations on 900 MHz band. Resolution: Install RF repeater within 500 feet line-of-sight, or request cellular modem upgrade for isolated meters.', 'Troubleshooting Guide'),

(6, 'DOC_3', 'Substation Battery Maintenance - VRLA Lead-Acid Systems. Monthly Inspection: Visual check for signs of thermal runaway (bulging cases, acid deposits). Verify float voltage within 2.25-2.30 V/cell for VRLA batteries at 77F (25C). Adjust for temperature: Add 0.003 V/cell per degree F below 77F, subtract for temperatures above. Quarterly Testing: Perform impedance test on each cell using Megger BITE3 or equivalent. Baseline impedance established during commissioning - deviation >20% from baseline indicates cell degradation. Document trending data in battery management system. Annual Capacity Test: Discharge battery string at C/8 rate (8-hour discharge) to 1.75 V/cell endpoint. Capacity must exceed 80% of nameplate to remain in service. Batteries below 80% capacity require replacement planning - typical lead time 8-12 weeks for station-class batteries. Emergency replacement batteries should be staged at regional warehouse locations for 24-hour deployment capability.', 'Maintenance Procedure'),

(7, 'DOC_3', 'DC Control Power System Architecture - 125VDC Station Service. The 125VDC system provides control power for protective relays, circuit breaker trip coils, SCADA RTU, and emergency lighting. Battery sizing calculation: Load analysis shows 200A continuous load plus 400A momentary (breaker trips). Using IEEE 485 methodology, specify battery for 8-hour autonomy at continuous load plus worst-case contingency of simultaneous multi-breaker operation. Typical configuration: Two parallel strings of 60 cells each, 2500 Ah capacity. Charger sizing: Continuous load plus recharge current (typically C/10). Specify redundant chargers with automatic transfer for N+1 reliability. Ground detection system: Ungrounded DC systems require continuous ground fault monitoring. Install ground detector relay (Basler BE1-GRD) with 15 kOhm alarm threshold and 5 kOhm trip threshold. Ground faults must be investigated within 24 hours due to risk of undetected double-ground causing uncontrolled breaker operation.', 'System Design'),

(8, 'DOC_4', 'Underground Cable Fault Location - Time Domain Reflectometry. Equipment Required: Megger TDR2050 or equivalent with 10ns pulse width capability for high-resolution fault location. Cable Preparation: Disconnect both ends of faulted cable. Install safety grounds on de-energized cables. Connect TDR to cable conductor at accessible test point. Test Procedure: Set velocity factor (VF) based on cable type - XLPE insulated: VF = 0.54, EPR insulated: VF = 0.48, PILC (paper insulated lead covered): VF = 0.78. Fire test pulse and observe reflection pattern. Fault signatures: Open circuit shows positive reflection (same polarity as transmitted pulse), Short circuit shows negative reflection (inverted polarity), High-resistance fault may require thumping with DC hipot to break down fault temporarily. Distance to fault calculated as: Distance = (Time x VF x c) / 2, where c = speed of light. For faults >500 feet, consider using arc reflection method with 15kV surge generator for improved accuracy on high-resistance faults.', 'Testing Procedure'),

(9, 'DOC_4', 'Cable Ampacity Derating Factors - Duct Bank Installations. Base ampacity for 15kV XLPE cable (500 kcmil copper): 390A in free air at 40C ambient. Apply derating factors for installation conditions: Duct bank (3 circuits, 3-phase each): Factor = 0.65, yielding 254A. Depth of burial 36 inches: Factor = 0.95 (vs. 24 inches baseline). Soil thermal resistivity 120 C-cm/W: Factor = 0.85 (vs. 90 baseline). Ambient temperature 45C: Factor = 0.91 (vs. 40C baseline). Combined derating: 390A x 0.65 x 0.95 x 0.85 x 0.91 = 175A effective ampacity. Critical: These factors are multiplicative. Duct banks with heavily loaded adjacent circuits require thermal analysis using finite element software (CYMCAP or equivalent) to verify actual cable operating temperature does not exceed 90C for XLPE insulation. Cables operating above rated temperature experience accelerated insulation aging following Arrhenius equation - every 10C increase roughly halves expected cable life.', 'Engineering Reference'),

(10, 'DOC_5', 'Vegetation Management Safety Procedures - Line Clearance Tree Trimming. Minimum Approach Distance (MAD) for qualified line-clearance workers: 69kV: 3.17 feet, 138kV: 4.25 feet, 345kV: 8.17 feet. These distances apply to all conductive objects including tools, equipment, and vegetation debris. Work Positioning: Establish exclusion zone around work area equal to tree height plus 10 feet. Position chipper/equipment outside exclusion zone to prevent struck-by incidents from falling limbs. Aerial lift operation requires spotter when working within 10 feet of energized conductors. Weather Restrictions: Suspend climbing operations when wind exceeds 25 mph sustained or 35 mph gusts. Lightning: All personnel must be grounded and out of trees when lightning observed within 10 miles - use 30/30 rule (30 seconds flash-to-bang = 6 miles, wait 30 minutes after last thunder). Hot weather protocols: Mandatory rest breaks every 30 minutes when heat index exceeds 103F. Emergency Response: All crew members trained in pole-top rescue and CPR/AED use. Rescue equipment (descender, carabiner, rescue harness) within 100 feet of elevated workers at all times.', 'Safety Procedure'),

(11, 'DOC_5', 'NERC FAC-003 Vegetation Management Compliance Requirements. Transmission lines 200kV and above require maintained clearances per Table 1: Zone 1 (active management): Maintain minimum vegetation clearance distance (MVCD) plus buffer. For 345kV, MVCD = 4.82 feet, typical buffer = 2 feet, requiring minimum 7 feet maintained clearance. Inspection cycle: Ground patrol twice annually, aerial patrol (helicopter or drone) once annually for Zones 1-2. Imminent threat vegetation (ITVs) must be removed within 24 hours of identification. Documentation requirements: GPS coordinates of all vegetation work, pre/post photographs, species identification, disposal method. LiDAR survey recommended every 3 years to establish vegetation growth profiles and prioritize clearing activities. Real-time encroachment monitoring available through conductor-mounted sensors that detect changes in electrical field patterns caused by nearby vegetation. Integration with outage management system enables automatic work order generation when sensors detect potential encroachment.', 'Regulatory Compliance'),

(12, 'DOC_6', 'SCADA System Architecture - DNP3 Protocol Implementation. Master Station Configuration: Poll interval for critical measurements (breaker status, transformer load): 2 seconds. Poll interval for analog values (voltage, current, power): 10 seconds. Event data polling: Integrity poll every 60 seconds with change-of-state reporting enabled. DNP3 Settings for RTU/IED: Device address: Unique per device (1-65519). Confirm mode: Enabled for control operations. Application layer timeout: 5 seconds. Link layer retry: 3 attempts with 2-second interval. Unsolicited response: Enabled for Class 1 (critical alarms) and Class 2 (normal alarms). Security: Enable Secure Authentication (SA) per IEEE 1815 for all critical infrastructure. Control Command Structure: CROB (Control Relay Output Block) with Select-Before-Operate (SBO) required for all breaker operations. Trip-Close-Trip sequence for transformer de-energization. Response time requirement: Control operation acknowledgment within 2 seconds for distribution automation schemes.', 'System Configuration'),

(13, 'DOC_6', 'Cybersecurity Requirements - NERC CIP Compliance for SCADA Systems. CIP-005: Electronic Security Perimeter (ESP) must be defined for all SCADA networks. Implement firewall rules permitting only required DNP3 traffic (TCP/UDP port 20000). All remote access requires multi-factor authentication and encrypted VPN tunnel. CIP-007: System hardening requirements - disable unnecessary services, apply security patches within 35 days of vendor release. Antivirus/whitelisting required on all Windows-based SCADA components. CIP-010: Configuration management baseline must document all authorized software, ports, and services. Any deviation requires formal change control process. CIP-011: Information protection - SCADA system diagrams and IP addresses classified as BES Cyber System Information (BCSI). Storage and transmission requires encryption (AES-256 minimum). Incident Response: Reportable cyber incidents must be reported to E-ISAC within 1 hour of detection. Preserve forensic evidence by capturing system logs, network traffic, and memory dumps before remediation activities.', 'Security Compliance')

ON CONFLICT (CHUNK_ID) DO NOTHING;

SELECT 'Loaded ' || COUNT(*) || ' technical manual chunks' AS STATUS FROM TECHNICAL_MANUALS_PDF_CHUNKS;
